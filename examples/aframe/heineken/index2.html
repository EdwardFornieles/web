<!doctype html>
<html>
  <head>
    <title>JINI Photo Mode</title>

    <script src="//apps.8thwall.com/requirements.js"></script>

    <script src="//cdn.8thwall.com/web/aframe/8frame-0.8.2.min.js"></script>

    <!-- 8thWall (wrapper always required) -->
    <script async src="//apps.8thwall.com/xrweb?appKey=6IYanreMoICeGsT9xpzol5C76QAd1ab9dVN4QFK7ZzPWYgs4GVczGGE3hGL5hQJwOWn0Tw"></script>

    <script src="//cdn.8thwall.com/web/aframe/aframe-extras-4.2.0.min.js"></script>
    <script src="//cdn.8thwall.com/web/aframe/aframe-animation-component-5.1.2.min.js"></script>
    <script src="//cdn.8thwall.com/web/xrextras/xrextras.js"></script>
    <script src="bundle.js"></script>

    <link rel="stylesheet" href="index.css">

    <!-- Google Tag Manager -->
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-WHW972G');
        </script>
    <!-- End Google Tag Manager -->
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WHW972G"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="overlay" class="absolute-fill">

      <div id="recenterButtonContainer">
        <img src="img/reposition.png">
      </div>

      <div id="jiniLookButton" class="lookCamera">
        <img id="lookCameraIcon" src="img/look-filled.png">
        <img id="lookLockedIcon" src="img/look-outline.png">
      </div>

      <div style="position: absolute; left: 0; right: 0;">
        <fullscreen-button></fullscreen-button>
      </div>

      <photo-mode></photo-mode>

      <div id="tutorialCallouts" class="absolute-fill hidden">

        <div id="tapGroundTutorial" class="tutorial-callout-container">
          <div class="tutorial-callout">
            Tap ground to move JINI
          </div>
        </div>
        <div id="strikePoseTutorial" class="tutorial-callout-container">
          <div class="tutorial-callout arrow-right">
            Strike a pose!
          </div>
        </div>

        <div id="lockGazeTutorial" class="tutorial-callout-container">
          <div class="tutorial-callout arrow-bottom-middle-left">
            Lock or unlock JINI's gaze
          </div>
        </div>

        <div id="resetTutorial" class="tutorial-callout-container">
          <div class="tutorial-callout arrow-bottom-middle-right">
            Reset JINI's position
          </div>
        </div>
      </div> <!-- End tutorial callouts -->

    </div> <!--End overlay-->

    <a-scene swipe-detector="element: body"
      recenter
      photo-mode="state:photoModeCapture"
      xrextras-almost-there="url:8th.io/jinicam"
      xrextras-loading
      xrextras-runtime-error
      xrweb
      antialias="true"
      model-viewer="dataUrl:models.json"
      tutorial >

      <a-assets>

        <a-asset-item id="jiniModel" src="models/jini-final.glb"></a-asset-item>
        <a-asset-item id="lampModel" src="models/justBall.glb"></a-asset-item>
        <a-asset-item id="projModel" src="models/justProj.glb"></a-asset-item>
        <img id="coneTex" src="img/cone-swirl.png">

        <!-- Cubemap Assets -->
        <img src="cubemap/posx.jpg">
        <img src="cubemap/posy.jpg">
        <img src="cubemap/posz.jpg">
        <img src="cubemap/negx.jpg">
        <img src="cubemap/negy.jpg">
        <img src="cubemap/negz.jpg">

      </a-assets>

      <a-camera
        id="camera"
        look-controls="touchEnabled: false"
        position="0 4 5">

        <a-entity
            id="reticle"
            raycaster="objects: .cantap"
            cursor="
              fuse: false;
              rayOrigin: mouse;">
        </a-entity>
      </a-camera>  <!-- /camera -->

      <a-entity id="anchor">

      </a-entity> <!-- /anchor -->

      <a-entity
        id="directionalLightBase"
        attach="target: jiniBase">
        <a-light
            id="dirLight"
            target="#jiniBase"
            position="-3 5 4"
            intensity="1"
            light="castShadow: true;
              shadowMapHeight: 2048;
              shadowMapWidth: 2048"></a-light>
      </a-entity>

      <a-entity
        id="lamp"
        follow-roller="target: jiniBase;
          ball: ball"
        scale="2 2 2"
        on: landed;
        img: #sparkTex;
        color: #0ff;
        scale: 0.25;
        pscale: 0.25;
        interpolate: true;
        dur: 750">
          <a-entity
          id="ball"
          gltf-model="#lampModel"
          cube-env-map="path: cubemap/;
           extension: jpg;"
           position="0 0.125 0"
          self-shadow
          ></a-entity>
          <a-entity
          id="proj"
          look-at-slerp="target: jini;
            tilt: true;
            targetOffset: 0 1.5 0;
            axis: 0 1 0;
            factor: 1;"
          gltf-model="#projModel"
          cube-env-map="path: cubemap/;
           extension: jpg;"
          position="0 0.125 0"
          self-shadow
          ><a-entity
            id="lightcone"
            animate-cone
            geometry="primitive: cone;
              radiusBottom: 0.2;
              radiusTop: 0;
              height: 0.35;
              segmentsRadial: 24;
              segmentsHeight: 12;
              openEnded: true;"
            material="src: #coneTex;
              transparent: true;
              opacity: 1;
              depthWrite: false;
              side: double;
              shader: flat"
            position="0 0.375 0"
            rotation="180 0 0"
          ></a-entity>
        </a-entity>
      </a-entity>   <!-- /lamp -->

      <a-entity
        id="jiniBase"
        move-controller="moveY: false"
        jini-look-manager
        look-at-slerp="target: camera; offset: 0 2.5 0; tilt: true"
        position="0 0.25 0"
        click-move>
        <a-entity
          id="jini"
          class="cantap"
          gltf-model="#jiniModel"
          cube-env-map="
            path: cubemap/;
            extension: jpg;"
          scale="2 2 2"
          animation-mixer="
            clip: idleFloat;
            loop: repeat;"
          shadow
          bob
          jini-photo-mode>
        </a-entity>  <!-- /jini -->
      </a-entity> <!-- /jini base -->

      <a-entity
        id="ground"
        ground-strike
        class="cantap"
        static-body
        geometry="primitive: box"
        scale="100 2 100"
        position="0 -1 0"
        rotation="0 0 0"
        shadow-material
        shadow>
      </a-entity>

<!--  Lights -->
      <a-light
        type="ambient"
        intensity="0.9">
      </a-light>
    </a-scene>
  </body>
</html>
